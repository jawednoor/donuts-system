<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>الدفعات المالية</title>
  <link rel="icon" type="image/png" href="logo-01.png">
  <link rel="stylesheet" href="styles.css">
     <style>
    /* إعداد الصفحة العامة */
    body, html {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(135deg, #ffc0cb 0%, #ffb6c1 50%, #ffc0cb 100%);
      font-family: 'Cairo', sans-serif;
    }

    /* تصميم الشعار ومسمى الصفحة خارج الحاوية */
    .page-header {
      text-align: center;
      padding: 0.5rem 1rem;
      background: transparent;
      margin-bottom: 0.5rem;
    }
    
    .page-logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 0.3rem auto;
      border-radius: 50%;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      background: white;
      padding: 6px;
      border: 2px solid rgba(233, 30, 99, 0.3);
      object-fit: contain;
      display: block;
    }
    
    .page-title {
      margin: 0;
      font-size: 1.8rem;
      color: #e91e63;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      font-family: 'Cairo', sans-serif;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
    }

    /* تحسينات إضافية للاستجابة */
    .form-container {
      width: 100%;
      max-width: 600px;
      height: calc(100vh - 150px);
      margin: 7rem auto 0 auto; /* إضافة 15rem من الأعلى */
      padding: 1.5rem;
      box-sizing: border-box;
      border-radius: 25px;
      overflow-y: auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }
    
    /* تحسين الحقول للجوالات */
    @media (max-width: 480px) {
      .page-header {
        padding: 0.3rem;
        margin-bottom: 0.3rem;
      }
      
      .page-logo {
        width: 60px;
        height: 60px;
        margin-bottom: 0.2rem;
        padding: 4px;
      }
      
      .page-title {
        font-size: 1.4rem;
        margin-bottom: 0.3rem;
      }

      .form-container {
        width: calc(100% - 1rem);
        height: calc(100vh - 120px);
        margin: 7rem 0.5rem 0 0.5rem; /* إضافة 15rem من الأعلى للجوال */
        padding: 1rem;
        border-radius: 20px;
      }
      
      .form-group {
        margin-bottom: 0.1rem; /* تقليل المسافة بين الحقول */
      }
      
      .form-group:first-of-type {
        margin-top: -1rem; /* تقليل المسافة من الأعلى للحقل الأول */
      }
      
      .form-group input,
      .form-group select {
        height: 55px; /* تكبير ارتفاع الحقول */
        padding: 12px 16px; /* زيادة المساحة الداخلية */
        font-size: 16px; /* تكبير الخط */
        border-radius: 10px;
        line-height: 1.3;
      }
      
      .form-group label {
        font-size: 1.2rem; /* تكبير خط التسميات */
        margin-bottom: 0.3rem;
        display: block;
      }
      
      .btn-submit {
        height: 55px; /* تكبير ارتفاع الزر */
        font-size: 1.3rem; /* تكبير خط الزر */
        margin: 1.2rem auto;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        line-height: 1;
        border: none;
        border-radius: 15px;
      }
      
      .small-nav-buttons {
        margin-top: 0.3rem; /* زيادة المسافة العلوية */
        margin-bottom: 1rem;
        display: flex;
        gap: 0.5rem;
        justify-content: center; /* توسيط أفقي */
        align-items: center; /* توسيط عمودي */
      }
      
      .btn-small {
        flex: 1;
        padding: 1.3rem 0.8rem; /* تكبير المساحة الداخلية */
        font-size: 1.1rem; /* تكبير خط الأزرار */
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1.2;
        border-radius: 12px; /* تحسين الحواف */
        text-decoration: none;
      }
      
      /* إخفاء الفوتر في الجوال */
      footer {
        display: none;
      }
    }
    
    /* تحسين للتابلت */
    @media (min-width: 481px) and (max-width: 768px) {
      .page-header {
        padding: 0.5rem;
        margin-bottom: 0.4rem;
      }
      
      .page-logo {
        width: 70px;
        height: 70px;
        margin-bottom: 0.3rem;
        padding: 5px;
      }
      
      .page-title {
        font-size: 1.6rem;
        margin-bottom: 0.4rem;
      }

      .form-container {
        width: calc(100% - 2rem);
        height: calc(100vh - 140px);
        margin: 10rem 1rem 0 1rem; /* إضافة 15rem من الأعلى للتابلت */
        padding: 1.5rem;
        border-radius: 22px;
      }
      
      .form-group {
        margin-bottom: 0.6rem; /* زيادة المسافة بين الحقول */
      }
      
      .form-group:first-of-type {
        margin-top: -0.8rem;
      }
      
      .form-group input,
      .form-group select {
        height: 55px; /* تكبير ارتفاع الحقول */
        padding: 12px 16px; /* زيادة المساحة الداخلية */
        font-size: 18px; /* تكبير حجم الخط أكثر */
        line-height: 1.3;
        border-radius: 12px;
      }
      
      .form-group label {
        font-size: 1.4rem; /* تكبير حجم خط التسميات */
        margin-bottom: 0.3rem;
        font-weight: 600;
      }
      
      .btn-submit {
        height: 55px; /* تكبير ارتفاع الزر */
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        margin: 1.2rem auto;
        font-size: 1.2rem; /* تكبير حجم الخط */
        border-radius: 15px;
        font-weight: 600;
      }
      
      .btn-small {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1.2rem 1.3rem; /* تكبير المساحة الداخلية */
        font-size: 1.1rem; /* تكبير الخط */
        border-radius: 12px;
        font-weight: 500;
      }
      
      .small-nav-buttons {
        margin-top: 0.2rem; /* تقليل المسافة العلوية */
        margin-bottom: 0.2rem; /* تقليل المسافة السفلية */
        gap: 0.3rem; /* تقليل المسافة بين الأزرار */
      }
      
      /* تحسين رأس النموذج للتابلت */
      .form-header h2 {
        margin-bottom: 0.2rem; /* تقليل المسافة تحت العنوان */
        font-size: 1.3rem;
      }
      
      .form-logo {
        width: 60px; /* تقليل حجم الشعار */
        height: 60px;
        margin-bottom: 0.3rem;
      }
    }
    
    /* تحسين للشاشات الكبيرة والآي باد برو */
    @media (min-width: 769px) {
      .page-header {
        padding: 0.8rem;
        margin-bottom: 0.6rem;
      }
      
      .page-logo {
        width: 90px;
        height: 90px;
        margin-bottom: 0.4rem;
        padding: 6px;
      }
      
      .page-title {
        font-size: 1.9rem;
        margin-bottom: 0.6rem;
      }

      .form-container {
        width: calc(100% - 4rem);
        height: calc(100vh - 160px);
        margin: 10rem 2rem 0 2rem; /* إضافة 15rem من الأعلى للشاشات الكبيرة */
        padding: 2rem;
        border-radius: 25px;
      }
      
      .form-group {
        margin-bottom: 1.5rem; /* زيادة المسافة بين الحقول */
      }
      
      .form-group:first-of-type {
        margin-top: 0.5rem;
      }
      
      .form-group input,
      .form-group select {
        height: 65px; /* تكبير ارتفاع الحقول أكثر */
        padding: 18px 25px; /* زيادة المساحة الداخلية */
        font-size: 20px; /* تكبير الخط أكثر */
        line-height: 1.4;
        border-radius: 15px;
      }
      
      .form-group label {
        font-size: 1.6rem; /* تكبير خط التسميات أكثر */
        margin-bottom: 0.6rem;
        font-weight: 600;
      }
      
      .btn-submit {
        height: 70px; /* تكبير ارتفاع الزر أكثر */
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        margin: 2.5rem auto;
        font-size: 1.5rem; /* تكبير خط الزر أكثر */
        border-radius: 18px;
        font-weight: 600;
      }
      
      .btn-small {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1.5rem 2rem; /* تكبير المساحة الداخلية أكثر */
        font-size: 1.3rem; /* تكبير خط الأزرار الصغيرة */
        border-radius: 15px;
        font-weight: 500;
      }
      
      .small-nav-buttons {
        margin-top: 1rem;
        margin-bottom: 1rem;
        gap: 1rem; /* زيادة المسافة بين الأزرار */
      }
      
      /* تحسين رأس النموذج للشاشات الكبيرة */
      .form-header h2 {
        margin-bottom: 1rem;
        font-size: 1.8rem; /* تكبير العنوان */
      }
      
      .form-logo {
        width: 80px; /* تكبير حجم الشعار */
        height: 80px;
        margin-bottom: 0.5rem;
      }
    }
    
    /* تحسين خاص للآي باد برو والشاشات الكبيرة جداً */
    @media (min-width: 1024px) {
      .page-header {
        padding: 1rem;
        margin-bottom: 0.8rem;
      }
      
      .page-logo {
        width: 100px;
        height: 100px;
        margin-bottom: 0.5rem;
        padding: 8px;
      }
      
      .page-title {
        font-size: 2.1rem;
        margin-bottom: 0.8rem;
      }

      .form-container {
        width: calc(100% - 6rem);
        height: calc(100vh - 180px);
        margin: 13rem 3rem 0 3rem; /* إضافة 10rem من الأعلى للشاشات الكبيرة جداً */
        padding: 2.5rem;
        border-radius: 30px;
      }
      
      .form-group input,
      .form-group select {
        height: 70px; /* ارتفاع أكبر */
        padding: 20px 30px; /* مساحة داخلية أكبر */
        font-size: 22px; /* خط أكبر */
      }
      
      .form-group label {
        font-size: 1.8rem; /* خط أكبر للتسميات */
        margin-bottom: 1rem;
      }
      
      .btn-submit {
        height: 75px; /* زر أكبر */
        font-size: 1.6rem; /* خط أكبر للزر */
        margin: 3rem auto;
      }
      
      .btn-small {
        padding: 1.8rem 2.5rem; /* مساحة أكبر */
        font-size: 1.4rem; /* خط أكبر */
      }
      
      .form-header h2 {
        font-size: 2.2rem; /* عنوان أكبر */
        margin-bottom: 2rem;
      }
      
      .form-logo {
        width: 100px; /* شعار أكبر */
        height: 100px;
        margin-bottom: 1.5rem;
      }
    }

    /* تحسين خاص للآيباد برو 12.9 بوصة */
    @media (min-width: 1024px) and (max-width: 1366px) and (orientation: portrait) {
      .form-container {
        max-width: 1300px;
        width: calc(100% - 4rem);
        margin: 12rem 2rem 0 2rem;
        padding: 2rem;
      }
      
      .form-group input,
      .form-group select {
        height: 100px;
        font-size: 40px;
        padding: 100px 30px;
      }
      
      .form-group label {
        font-size: 3rem;
        margin-bottom: 1rem;
      }
      
      .btn-submit {
        height: 150px;
        font-size: 5rem;
        margin: 3.5rem auto;
      }
      
      .btn-small {
        padding: 2rem 3rem;
        font-size: 2rem;
        border-radius: 20px;
        font-weight: 600;
      }
      
      .small-nav-buttons {
        margin-top: 2rem;
        margin-bottom: 2rem;
        gap: 2rem;
        display: flex;
        justify-content: center;
      }
    }

    /* تحسين للآيباد ميني */
    @media (min-width: 768px) and (max-width: 1024px) and (orientation: portrait) {
      .form-container {
        max-width: 900px;
        width: calc(100% - 3rem);
        margin: 9rem 1.5rem 0 1.5rem;
        padding: 2rem;
      }
      
      .form-group input,
      .form-group select {
        height: 65px;
        font-size: 20px;
        padding: 18px 25px;
      }
      
      .form-group label {
        font-size: 1.7rem;
        margin-bottom: 0.8rem;
      }
      
      .btn-submit {
        height: 70px;
        font-size: 1.5rem;
        margin: 2.8rem auto;
      }
      
      .btn-small {
        padding: 1.5rem 2rem;
        font-size: 1.3rem;
        border-radius: 15px;
        font-weight: 500;
      }
      
      .small-nav-buttons {
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
        gap: 1rem;
        display: flex;
        justify-content: center;
      }
    }

    /* تحسين للشاشة العرضية (Landscape) - جميع الأجهزة */
    @media (orientation: landscape) and (max-height: 768px) {
      .page-header {
        padding: 0.3rem;
        margin-bottom: 15rem;
      }
      
      .page-logo {
        width: 50px;
        height: 50px;
        margin-bottom: 5rem;
      }
      
      .page-title {
        font-size: 1.3rem;
        margin-bottom: 0.2rem;
      }
      
      .form-container {
        height: calc(100vh - 80px);
        margin: 7rem auto 0 auto;
        padding: 1rem;
        max-width: 90%;
        width: calc(100% - 2rem);
      }
      
      .form-group {
        margin-bottom: 0.5rem;
      }
      
      .form-group input,
      .form-group select,
      .form-group textarea {
        height: 45px;
        font-size: 16px;
        padding: 10px 15px;
      }
      
      .form-group textarea {
        height: 60px !important;
        resize: vertical;
      }
      
      .form-group label {
        font-size: 1.1rem;
        margin-bottom: 0.2rem;
      }
      
      .btn-submit {
        height: 50px;
        font-size: 1.2rem;
        margin: 1rem auto;
      }
      
      .btn-small {
        padding: 0.8rem 1.2rem;
        font-size: 1rem;
        border-radius: 10px;
        font-weight: 500;
      }
      
      .small-nav-buttons {
        margin-top: 0.8rem;
        margin-bottom: 0.8rem;
        gap: 0.8rem;
        display: flex;
        justify-content: center;
      }
    }

    /* تحسين خاص للآيباد برو في الوضع العرضي */
    @media (min-width: 1024px) and (orientation: landscape) {
      .form-container {
        max-width: 1000px;
        width: calc(100% - 8rem);
        margin: 4rem 4rem 0 4rem;
        padding: 2.5rem;
        height: calc(100vh - 120px);
      }
      
      .form-group {
        margin-bottom: 1rem;
      }
      
      .form-group input,
      .form-group select {
        height: 60px;
        font-size: 20px;
        padding: 18px 25px;
      }
      
      .form-group textarea {
        height: 80px !important;
      }
      
      .form-group label {
        font-size: 1.6rem;
        margin-bottom: 0.6rem;
      }
      
      .btn-submit {
        height: 65px;
        font-size: 1.4rem;
        margin: 2rem auto;
      }
      
      .btn-small {
        padding: 1.2rem 2rem;
        font-size: 1.2rem;
        border-radius: 12px;
        font-weight: 500;
      }
      
      .small-nav-buttons {
        margin-top: 1.5rem;
        margin-bottom: 1rem;
        gap: 1.5rem;
        display: flex;
        justify-content: center;
      }
    }
    
    /* تحسين عام للحقول */
    .form-group input,
    .form-group select {
      width: 100%;
      box-sizing: border-box;
      -webkit-appearance: none;
      appearance: none;
      transition: all 0.3s ease;
      overflow: hidden; /* منع فيض النص */
      text-overflow: ellipsis; /* إضافة نقاط عند قص النص */
      white-space: nowrap; /* منع كسر الأسطر */
    }
    
    .form-group select {
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23d81389' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: left 10px center; /* تحسين موضع السهم */
      background-size: 16px; /* تصغير حجم السهم */
      padding-left: 35px; /* تقليل المساحة اليسرى */
    }
    
    /* تحسين التركيز */
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #d81389;
      box-shadow: 0 0 0 3px rgba(216, 19, 137, 0.1);
      background: white;
    }

    /* Classes المساعدة */
    .hidden {
      display: none !important;
    }

    /* Loading Screen مع رسائل الاستغفار */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }

    .loading-overlay:not(.hidden) {
      display: flex;
    }

    .loading-container {
      background: white;
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #e91e63;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 18px;
      color: #333;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .istighfar-text {
      font-size: 16px;
      color: #e91e63;
      margin-bottom: 10px;
      font-weight: 600;
      opacity: 0;
      animation: fadeInOut 3s ease-in-out infinite;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0; transform: translateY(10px); }
      50% { opacity: 1; transform: translateY(0); }
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: #f0f0f0;
      border-radius: 3px;
      margin-top: 20px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(45deg, #e91e63, #ffb6c1);
      border-radius: 3px;
      width: 0%;
      animation: fillProgress 5s ease-in-out infinite;
    }

    @keyframes fillProgress {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }

    /* نظام الإشعارات الخضراء */
    .notifications-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      max-width: 400px;
      pointer-events: none;
    }

    .notification {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      padding: 16px 24px;
      margin-bottom: 10px;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
      font-size: 16px;
      font-weight: 500;
      border-right: 5px solid #2E7D32;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
      pointer-events: auto;
      text-align: right;
      direction: rtl;
      font-family: 'Cairo', sans-serif;
    }

    .notification.error {
      background: linear-gradient(135deg, #f44336, #d32f2f);
      border-right-color: #b71c1c;
      box-shadow: 0 8px 25px rgba(244, 67, 54, 0.3);
    }

    .notification.show {
      opacity: 1;
      transform: translateX(0);
    }

    .notification.hiding {
      opacity: 0;
      transform: translateX(100%);
    }

    @media (max-width: 768px) {
      .notifications-container {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
      }
      
      .notification {
        font-size: 14px;
        padding: 12px 16px;
      }
    }
  </style>
</head>
<body>
  <!-- حاوية الإشعارات -->
  <div class="notifications-container" id="notifications-container"></div>

  <!-- الشعار ومسمى الصفحة خارج الحاوية -->
  <div class="page-header">
    <img src="logo-01.png" alt="شعار دونات وحشوة" class="page-logo">
    <h1 class="page-title">الدفعات المالية</h1>
  </div>

  <main>
    <div class="form-container">
      <form id="supplyForm" class="payment-form">
        <div class="form-group">
          <label for="customer">اختر العميل:</label>
          <select id="customer" required>
            <option value="">اختر العميل...</option>
          </select>
        </div>

        <div class="form-group">
          <label for="date">تاريخ اليوم:</label>
          <input type="date" id="date" required>
        </div>

        <div class="form-group">
          <label for="amount">المبلغ:</label>
          <input type="number" id="amount" step="0.01" min="0" placeholder="أدخل المبلغ" required>
        </div>

        <div class="form-group">
          <label for="invoiceNumber">رقم الفاتورة:</label>
          <input type="text" id="invoiceNumber" placeholder="أدخل رقم الفاتورة" required>
        </div>

        <div class="form-group">
          <label for="paymentMethod">طريقة الدفع:</label>
          <select id="paymentMethod" required>
            <option value="">اختر طريقة الدفع...</option>
            <option value="كاش">كاش</option>
            <option value="تحويل">تحويل</option>
            <option value="شيك">شيك</option>
          </select>
        </div>

        <div class="form-group">
          <label for="mobile">رقم جوال المستلم (واتس):</label>
          <input type="tel" id="mobile" pattern="05[0-9]{8}" placeholder="05xxxxxxxx" required>
        </div>

        <div class="form-group">
          <label for="notes">ملاحظات (اختياري):</label>
          <textarea id="notes" rows="3" placeholder="أدخل أي ملاحظات إضافية"></textarea>
        </div>

        <button type="submit" class="btn-submit">حفظ الدفعة</button>
      </form>

      <div id="whatsappLink" class="whatsapp-link" style="display: none;">
        <p>تم حفظ البيانات بنجاح! يمكنك الآن إرسال التأكيد عبر واتساب:</p>
        <a id="whatsappUrl" target="_blank" class="btn-whatsapp">📱 إرسال عبر واتساب</a>
      </div>

      <!-- أزرار التنقل الصغيرة -->
      <div class="small-nav-buttons">
        <a href="index.html" class="btn-small">الرئيسية</a>
        <a href="Data_supply.html" class="btn-small">التوريد</a>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 نظام إدارة توريد الدونات والحشوة</p>
  </footer>

  <script>
    // Loading Screen مع رسائل الاستغفار
    function showLoadingScreen() {
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.classList.remove('hidden');
        loadingOverlay.style.display = 'flex';
        
        // مصفوفة رسائل الاستغفار
        const istighfarMessages = [
          'أستغفر الله العظيم',
          'استغفر الله العظيم الذي لا إله إلا هو الحي القيوم وأتوب إليه',
          'لا إله إلا أنت سبحانك إني كنت من الظالمين',
          'سبحان الله وبحمده سبحان الله العظيم',
          'اللهم صل وسلم على نبينا محمد',
          'لا حول ولا قوة إلا بالله',
          'حسبنا الله ونعم الوكيل',
          'اللهم أعني ولا تعن علي',
          'رب اغفر لي ذنبي وخطئي وجهلي',
          'اللهم بارك لنا فيما رزقتنا'
        ];
        
        let currentMessageIndex = 0;
        const istighfarText = document.getElementById('istighfarText');
        
        // تغيير الرسالة كل 2 ثانية
        window.istighfarInterval = setInterval(() => {
          currentMessageIndex = (currentMessageIndex + 1) % istighfarMessages.length;
          if (istighfarText) {
            istighfarText.textContent = istighfarMessages[currentMessageIndex];
          }
        }, 2000);
      }
    }

    function hideLoadingScreen() {
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.classList.add('hidden');
        loadingOverlay.style.display = 'none';
        
        // إيقاف تغيير رسائل الاستغفار
        if (window.istighfarInterval) {
          clearInterval(window.istighfarInterval);
          window.istighfarInterval = null;
        }
      }
    }

    // دالة إظهار الإشعارات الخضراء
    function showNotification(message, type = 'success') {
      const container = document.getElementById('notifications-container');
      if (!container) return;
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      container.appendChild(notification);
      
      // إظهار الإشعار مع تأثير الانزلاق
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);
      
      // إخفاء الإشعار بعد 3 ثوان
      setTimeout(() => {
        notification.classList.add('hiding');
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // نظام الإشعارات الخضراء
    function showNotification(message, type = 'success') {
      const container = document.getElementById('notifications-container');
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      container.appendChild(notification);
      
      // إظهار الإشعار مع تأثير الانزلاق
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);
      
      // إخفاء الإشعار بعد 3 ثوان
      setTimeout(() => {
        notification.classList.add('hiding');
        setTimeout(() => {
          if (container.contains(notification)) {
            container.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // جلب بيانات العملاء من Google Sheets (نفس Data_supply.html)
    function loadCustomers() {
      const customerSel = document.getElementById('customer');
      
      // إضافة خيار فارغ أولاً
      const emptyOption = document.createElement('option');
      emptyOption.value = '';
      emptyOption.textContent = 'اختر العميل';
      emptyOption.selected = true;
      customerSel.appendChild(emptyOption);
      
      // محاولة جلب البيانات من Google Sheets
      tryLoadFromGoogleSheets();
    }
    
    // محاولة جلب البيانات من Google Sheets المشارك
    function tryLoadFromGoogleSheets() {
      // استخدام رابط CSV مباشر للشيت المشارك
      const CUSTOMER_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1POl2ntUZL9x0n79Wr1_ZswEETSFUrgjMrXcFtDfoFqA/export?format=csv&gid=0';
      
      fetch(CUSTOMER_SHEET_URL)
        .then(res => res.text())
        .then(csvData => {
          console.log('تم الاتصال بنجاح');
          console.log('CSV Data:', csvData.substring(0, 200) + '...'); // عرض أول 200 حرف للتشخيص
          
          const lines = csvData.split('\n');
          const customerSel = document.getElementById('customer');
          const uniqueCustomers = new Set(); // لتجنب التكرار
          
          // معالجة البيانات من CSV
          lines.forEach((line, index) => {
            if (index === 0) return; // تخطي الرأس
            
            const columns = line.split(',');
            if (columns.length > 1) {
              // أخذ العمود الثاني (العمود B) وتنظيفه للعملاء
              let customer = columns[1];
              if (customer) {
                customer = customer.trim().replace(/"/g, '').replace(/'/g, '');
                
                if (customer && customer !== '' && customer !== 'undefined') {
                  uniqueCustomers.add(customer); // إضافة للمجموعة لتجنب التكرار
                }
              }
            }
          });
          
          // مسح القائمة الحالية
          customerSel.innerHTML = '';
          
          // إضافة خيار فارغ أولاً
          const emptyOption = document.createElement('option');
          emptyOption.value = '';
          emptyOption.textContent = 'اختر العميل';
          emptyOption.selected = true;
          customerSel.appendChild(emptyOption);
          
          // إضافة العملاء الفريدين
          uniqueCustomers.forEach(customer => {
            const opt = document.createElement('option');
            opt.value = customer;
            opt.textContent = customer;
            customerSel.appendChild(opt);
          });
          
          console.log('تم تحديث البيانات من Google Sheets:', uniqueCustomers.size, 'عميل فريد');
          
          if (customerSel.options.length > 1) {
            // عرض رسالة نجاح مؤقتة خضراء
            const successMessage = document.createElement('div');
            successMessage.style.cssText = `
              position: fixed;
              top: 20px;
              right: 20px;
              background: #28a745;
              color: white;
              padding: 10px 20px;
              border-radius: 8px;
              box-shadow: 0 4px 6px rgba(0,0,0,0.1);
              z-index: 1000;
              font-size: 14px;
            `;
            successMessage.textContent = `✅ تم تحميل ${uniqueCustomers.size} عميل من قاعدة البيانات`;
            document.body.appendChild(successMessage);
            
            // إزالة الرسالة بعد 3 ثوان
            setTimeout(() => {
              if (document.body.contains(successMessage)) {
                document.body.removeChild(successMessage);
              }
            }, 3000);
          }
        })
        .catch(err => {
          console.error('خطأ في جلب البيانات من Google Sheets:', err);
          console.log('استخدام البيانات الاحتياطية');
        });
    }
    
    // استدعاء دالة التحميل مع Loading Screen
    showLoadingScreen();
    
    // تحميل البيانات مع Promise
    new Promise((resolve) => {
      loadCustomers();
      // تأخير بسيط للسماح بتحميل البيانات
      setTimeout(resolve, 2000);
    }).then(() => {
      hideLoadingScreen();
    });
    
    // تعيين تاريخ اليوم تلقائياً (نفس Data_supply.html)
    document.getElementById('date').valueAsDate = new Date();

    // معالجة إرسال النموذج
    document.getElementById('supplyForm').addEventListener('submit', function(e) {
      e.preventDefault();
      console.log('تم الضغط على زر الإرسال!');
      
      // عرض Loading Screen
      showLoadingScreen();
      
      // جمع البيانات
      const customer = document.getElementById('customer').value;
      const date = document.getElementById('date').value;
      const amount = document.getElementById('amount').value;
      const invoiceNumber = document.getElementById('invoiceNumber').value;
      const paymentMethod = document.getElementById('paymentMethod').value;
      const mobile = document.getElementById('mobile').value;
      const notes = document.getElementById('notes').value;

      console.log('البيانات المدخلة:', { customer, date, amount, invoiceNumber, paymentMethod, mobile, notes });

      // التحقق من صحة البيانات
      if (!customer) {
        hideLoadingScreen();
        showNotification('⚠️ يرجى اختيار العميل', 'error');
        console.log('خطأ: لم يتم اختيار العميل');
        return;
      }
      if (!date) {
        hideLoadingScreen();
        showNotification('⚠️ يرجى اختيار التاريخ', 'error');
        console.log('خطأ: لم يتم اختيار التاريخ');
        return;
      }
      if (!amount || amount <= 0) {
        hideLoadingScreen();
        showNotification('⚠️ يرجى إدخال مبلغ صحيح', 'error');
        console.log('خطأ: المبلغ غير صحيح:', amount);
        return;
      }
      if (!invoiceNumber) {
        hideLoadingScreen();
        showNotification('⚠️ يرجى إدخال رقم الفاتورة', 'error');
        console.log('خطأ: لم يتم إدخال رقم الفاتورة');
        return;
      }
      if (!paymentMethod) {
        hideLoadingScreen();
        showNotification('⚠️ يرجى اختيار طريقة الدفع', 'error');
        console.log('خطأ: لم يتم اختيار طريقة الدفع');
        return;
      }
      if (!mobile || !mobile.match(/^05[0-9]{8}$/)) {
        hideLoadingScreen();
        showNotification('⚠️ يرجى إدخال رقم جوال صحيح (يبدأ بـ 05 ويتكون من 10 أرقام)', 'error');
        console.log('خطأ: رقم الجوال غير صحيح:', mobile);
        return;
      }

      console.log('جميع البيانات صحيحة، سيتم الإرسال...');

      // إرسال البيانات إلى Google Apps Script للدفعات
      const data = { 
        type: 'payment',     // مهم جداً - يجب أن يكون payment
        customer: customer,
        date: date,
        amount: parseFloat(amount),  // تأكد من أنه رقم
        invoiceNumber: invoiceNumber,
        paymentMethod: paymentMethod,
        mobile: mobile,
        notes: notes || ''
      };
      console.log('إرسال البيانات للدفعات:', data);

      // إرسال البيانات إلى Google Sheets - شيت payments
      fetch('https://script.google.com/macros/s/AKfycbxvSfmuCxHMhrYigSo0j2wX0lsy0XiVHlBAaM3yoxHHnHKnOdTBX3vGAYeCnV9FGwdpTg/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(() => {
        console.log('تم إرسال البيانات إلى Google Sheets بنجاح');
        
        // إخفاء Loading Screen قبل إظهار الإشعار
        hideLoadingScreen();
        
        // إظهار إشعار نجاح بدلاً من alert
        showNotification('✅ تم تسجيل الدفعة بنجاح في Google Sheets!', 'success');

        // حفظ بيانات الإيصال في localStorage
        localStorage.setItem('lastReceiptNumber', generateReceiptNumber());
        localStorage.setItem('lastCustomer', customer);
        localStorage.setItem('lastInvoiceNumber', invoiceNumber);
        localStorage.setItem('lastAmount', amount);
        localStorage.setItem('lastPaymentMethod', paymentMethod);
        localStorage.setItem('lastMobile', mobile);
        localStorage.setItem('lastNotes', notes);

        // تأخير قصير ثم فتح صفحة الإيصال
        setTimeout(() => {
          const receiptUrl = `payment-receipt.html?customer=${encodeURIComponent(customer)}&invoiceNumber=${encodeURIComponent(invoiceNumber)}&amount=${amount}&paymentMethod=${encodeURIComponent(paymentMethod)}&mobile=${encodeURIComponent(mobile)}&notes=${encodeURIComponent(notes)}`;
          window.open(receiptUrl, '_blank');
        }, 1000);

        // إعادة تعيين النموذج
        document.getElementById('supplyForm').reset();
        document.getElementById('date').valueAsDate = new Date();
      })
      .catch(err => {
        console.error('خطأ في إرسال البيانات:', err);
        
        // إخفاء Loading Screen في حالة الخطأ
        hideLoadingScreen();
        
        // إظهار إشعار خطأ بدلاً من التنبيه المنبثق
        showNotification('⚠️ حدث خطأ في تسجيل البيانات. سيتم فتح واتساب على أي حال...', 'error');
        
        // حتى لو فشل التسجيل، سنفتح واتساب
        const phone = '966' + mobile.slice(1);
        const message = `🔔 تأكيد دفعة مالية جديدة\n\n` +
                       `👤 العميل: *${customer}*\n` +
                       `📅 التاريخ: *${date}*\n` +
                       `💰 المبلغ: *${amount}* ريال\n` +
                       `📄 رقم الفاتورة: *${invoiceNumber}*\n` +
                       `💳 طريقة الدفع: *${paymentMethod}*\n` +
                       `📝 ملاحظات: *${notes || 'لا توجد'}*\n\n` +
                       `تم التسجيل في سجلاتنا ... وشكرا لكم 🙏\n` +
                       `دونات وحشوة 🍩`;
        
        const whatsappUrl = `https://api.whatsapp.com/send/?phone=${phone}&text=${encodeURIComponent(message)}&type=phone_number&app_absent=0`;
        
        document.getElementById('whatsappUrl').href = whatsappUrl;
        document.getElementById('whatsappLink').style.display = 'block';
        
        setTimeout(() => {
          window.open(whatsappUrl, '_blank');
        }, 500);

        // إعادة تعيين النموذج
        document.getElementById('supplyForm').reset();
        document.getElementById('date').valueAsDate = new Date();
      });
    });

    // دالة لتوليد رقم إيصال فريد
    function generateReceiptNumber() {
      const now = new Date();
      const year = now.getFullYear().toString().substr(-2);
      const month = (now.getMonth() + 1).toString().padStart(2, '0');
      const day = now.getDate().toString().padStart(2, '0');
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      return `R${year}${month}${day}${random}`;
    }
  </script>

  <!-- Loading Screen مع رسائل الاستغفار -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-text">جاري حفظ الدفعة...</div>
      <div class="istighfar-text" id="istighfarText">أستغفر الله العظيم</div>
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
    </div>
  </div>
</body>
</html>
