<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ุฅุฏุฎุงู ุฏูุนุฉ ูุงููุฉ - ุฏููุงุช ูุญุดูุฉ</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>๐ฐ ุฅุฏุฎุงู ุฏูุนุฉ ูุงููุฉ</h1>
    <nav>
      <a href="index.html">๐ ุงูุฑุฆูุณูุฉ</a>
      <a href="Data_supply.html">๐ฆ ุตูุญุฉ ุงูุชูุฑูุฏ</a>
      <a href="pay.html">๐ฐ ุงูุฏูุนุงุช ุงููุงููุฉ</a>
    </nav>
  </header>

  <main>
    <div class="form-container">
      <div class="form-header">
        <img src="logo-01.png" alt="ุดุนุงุฑ ุฏููุงุช ูุญุดูุฉ" class="form-logo">
        <h2>ุชุณุฌูู ุฏูุนุฉ ูุงููุฉ</h2>
      </div>
      
      <form id="paymentForm" class="payment-form">
        <div class="form-group">
          <label for="customer">ุงุฎุชุฑ ุงูุนููู:</label>
          <select id="customer" name="customer" required>
            <option value="">ุงุฎุชุฑ ุงูุนููู...</option>
          </select>
        </div>

        <div class="form-group">
          <label for="paymentDate">ุชุงุฑูุฎ ุงูุฏูุน:</label>
          <input type="date" id="paymentDate" name="paymentDate" required>
        </div>

        <div class="form-group">
          <label for="amount">ุงููุจูุบ:</label>
          <input type="number" id="amount" name="amount" step="0.01" min="0" placeholder="ุฃุฏุฎู ุงููุจูุบ" required>
        </div>

        <div class="form-group">
          <label for="paymentMethod">ุทุฑููุฉ ุงูุฏูุน:</label>
          <select id="paymentMethod" name="paymentMethod" required>
            <option value="">ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน...</option>
            <option value="ููุฏู">ููุฏู</option>
            <option value="ุชุญููู ุจููู">ุชุญููู ุจููู</option>
            <option value="ุดูู">ุดูู</option>
            <option value="ุจุทุงูุฉ ุงุฆุชูุงู">ุจุทุงูุฉ ุงุฆุชูุงู</option>
          </select>
        </div>

        <div class="form-group">
          <label for="notes">ููุงุญุธุงุช (ุงุฎุชูุงุฑู):</label>
          <textarea id="notes" name="notes" rows="3" placeholder="ุฃุฏุฎู ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ"></textarea>
        </div>

        <div class="form-group">
          <label for="mobile">ุฑูู ุงูุฌูุงู:</label>
          <input type="tel" id="mobile" name="mobile" placeholder="05xxxxxxxx" pattern="[0-9]{10}" required>
        </div>

        <button type="submit" class="btn-submit">๐พ ุญูุธ ุงูุฏูุนุฉ</button>
      </form>

      <div id="whatsappLink" class="whatsapp-link" style="display: none;">
        <p>ุชู ุญูุธ ุงูุจูุงูุงุช ุจูุฌุงุญ! ููููู ุงูุขู ุฅุฑุณุงู ุงูุชุฃููุฏ ุนุจุฑ ูุงุชุณุงุจ:</p>
        <a id="whatsappUrl" target="_blank" class="btn-whatsapp">๐ฑ ุฅุฑุณุงู ุนุจุฑ ูุงุชุณุงุจ</a>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 ูุธุงู ุฅุฏุงุฑุฉ ุชูุฑูุฏ ุงูุฏููุงุช ูุงูุญุดูุฉ</p>
  </footer>

  <script>
    // ุชุญููู ูุงุฆูุฉ ุงูุนููุงุก ูู Google Sheets
    async function loadCustomers() {
      try {
        const response = await fetch('https://docs.google.com/spreadsheets/d/1POl2ntUZL9x0n79Wr1_ZswEETSFUrgjMrXcFtdfoFqA/export?format=csv&gid=0');
        const csvData = await response.text();
        const lines = csvData.split('\n');
        const customerSelect = document.getElementById('customer');
        
        for (let i = 1; i < lines.length; i++) {
          const columns = lines[i].split(',');
          if (columns[1] && columns[1].trim()) {
            const option = document.createElement('option');
            option.value = columns[1].trim();
            option.textContent = columns[1].trim();
            customerSelect.appendChild(option);
          }
        }
      } catch (error) {
        console.error('ุฎุทุฃ ูู ุชุญููู ุงูุนููุงุก:', error);
      }
    }

    // ุชุนููู ุงูุชุงุฑูุฎ ุงูุญุงูู
    document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];

    // ุชุญููู ุงูุนููุงุก ุนูุฏ ุชุญููู ุงูุตูุญุฉ
    window.addEventListener('load', loadCustomers);

    // ูุนุงูุฌุฉ ุฅุฑุณุงู ุงููููุฐุฌ
    document.getElementById('paymentForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const data = Object.fromEntries(formData);
      
      try {
        // ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู Google Sheets
        const response = await fetch('https://script.google.com/macros/s/AKfycbyvo3ExVKbjmoCw2Nmgywep4IPEgQzl6y7zpt_HMFd8RBpXBRZGIiQ9WC0Nhl78byDS9Q/exec', {
          method: 'POST',
          body: JSON.stringify({
            customer: data.customer,
            date: data.paymentDate,
            amount: data.amount,
            paymentMethod: data.paymentMethod,
            notes: data.notes || '',
            mobile: data.mobile,
            type: 'payment'
          }),
          headers: {
            'Content-Type': 'application/json',
          },
        });

        if (response.ok) {
          // ุฅูุดุงุก ุฑุณุงูุฉ ูุงุชุณุงุจ
          const message = `๐ ุชุฃููุฏ ุฏูุนุฉ ูุงููุฉ ุฌุฏูุฏุฉ\n\n` +
                         `๐ค ุงูุนููู: ${data.customer}\n` +
                         `๐ ุงูุชุงุฑูุฎ: ${data.paymentDate}\n` +
                         `๐ฐ ุงููุจูุบ: ${data.amount} ุฑูุงู\n` +
                         `๐ณ ุทุฑููุฉ ุงูุฏูุน: ${data.paymentMethod}\n` +
                         `๐ ููุงุญุธุงุช: ${data.notes || 'ูุง ุชูุฌุฏ'}\n\n` +
                         `ุดูุฑุงู ููู ๐\n` +
                         `ุฏููุงุช ูุญุดูุฉ ๐ฉ`;

          const whatsappUrl = `https://api.whatsapp.com/send/?phone=966${data.mobile.substring(1)}&text=${encodeURIComponent(message)}`;
          
          document.getElementById('whatsappUrl').href = whatsappUrl;
          document.getElementById('whatsappLink').style.display = 'block';
          
          // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
          this.reset();
          document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
          
          alert('ุชู ุญูุธ ุงูุฏูุนุฉ ุจูุฌุงุญ!');
        } else {
          throw new Error('ูุดู ูู ุญูุธ ุงูุจูุงูุงุช');
        }
      } catch (error) {
        console.error('ุฎุทุฃ:', error);
        alert('ุญุฏุซ ุฎุทุฃ ูู ุญูุธ ุงูุจูุงูุงุช. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.');
      }
    });
  </script>
</body>
</html>
