# إرشادات إعداد Google Apps Script لنظام الفواتير

## 📋 الخطوات المطلوبة:

### 1. إنشاء مشروع Google Apps Script:
1. اذهب إلى: https://script.google.com
2. انقر على "مشروع جديد"
3. انسخ محتوى ملف `google-apps-script.js` والصقه في المحرر
4. احفظ المشروع باسم "نظام فواتير دونات وحشوة"

### 2. إعداد الصلاحيات:
1. في قائمة "Services" أضف:
   - Google Sheets API
2. في "Permissions" تأكد من وجود:
   - حقوق الوصول إلى Google Sheets
   - حقوق تشغيل Web App

### 3. نشر Web App:
1. انقر على "Deploy" > "New Deployment"
2. اختر نوع "Web app"
3. في الإعدادات:
   - **Execute as**: Me (بريدك الإلكتروني)
   - **Who has access**: Anyone
4. انقر على "Deploy"
5. انسخ رابط Web App URL

### 4. تحديث رابط في ملف HTML:
```javascript
const GOOGLE_APPS_SCRIPT_URL = 'YOUR_WEB_APP_URL_HERE';
```
استبدل `YOUR_WEB_APP_URL_HERE` برابط Web App الذي حصلت عليه.

### 5. إعداد Google Sheets:
1. تأكد من أن معرف الجدول صحيح في Apps Script:
   ```javascript
   const SPREADSHEET_ID = '1POl2ntUZL9x0n79Wr1_ZswEETSFUrgjMrXcFtDfoFqA';
   ```
2. تأكد من وجود شيت باسم "invoices" أو قم بإنشائه
3. يمكنك تشغيل دالة `setupSheet()` في Apps Script لإعداد العناوين تلقائياً

### 6. اختبار النظام:
1. في Apps Script، شغل دالة `testAddInvoiceItems()` للاختبار
2. تحقق من إضافة البيانات في Google Sheets
3. اختبر النظام من صفحة HTML

## 📊 هيكل البيانات في Google Sheets:

| العمود | الحقل | الوصف |
|--------|-------|--------|
| A | رقم الفاتورة | 52002507001 |
| B | التاريخ | 8 أغسطس 2025 |
| C | اسم العميل | عميل كريم |
| D | اسم الصنف | دونات شوكولاتة |
| E | الكمية | 2 |
| F | السعر | 25.00 |

## 🔢 نظام ترقيم الفواتير:

### تركيب الرقم: 52002507001
- **520**: كود الفاتورة الثابت
- **025**: السنة (2025 → 25)
- **07**: الشهر (يوليو → 07)
- **001**: ترتيب الفاتورة في الشهر

### مثال للأرقام:
- أول فاتورة في يوليو 2025: `52002507001`
- ثاني فاتورة في يوليو 2025: `52002507002`
- أول فاتورة في أغسطس 2025: `52002508001`
- أول فاتورة في يناير 2026: `52002601001`

## ⚠️ ملاحظات مهمة:

1. **عند تسجيل أكثر من صنف**: كل صنف يُسجل في صف منفصل مع تكرار:
   - رقم الفاتورة
   - التاريخ
   - اسم العميل

2. **رقم الفاتورة قابل للتعديل**: يمكن تعديل الرقم المولد تلقائياً قبل إنشاء الفاتورة

3. **العداد الشهري**: يتم حفظ العداد في التخزين المحلي للمتصفح ويعاد تعيينه كل شهر

4. **الأمان**: تأكد من إعداد الصلاحيات بشكل صحيح في Google Apps Script

## 🔧 استكشاف الأخطاء:

### إذا لم تعمل البيانات:
1. تحقق من رابط Web App
2. تأكد من نشر النسخة الجديدة من Apps Script
3. راجع Console في المتصفح للأخطاء
4. تحقق من صلاحيات Google Sheets

### إذا لم يعمل ترقيم الفواتير:
1. امسح التخزين المحلي في المتصفح
2. أعد تحميل الصفحة
3. تحقق من صحة التاريخ في النظام

## 📞 للدعم:
راجع ملف `google-apps-script.js` للدوال المتاحة واختبر النظام خطوة بخطوة.
